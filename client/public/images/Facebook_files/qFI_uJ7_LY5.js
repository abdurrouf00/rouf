;/*FB_PKG_DELIM*/

__d("LSUpdateMessageSearchQueryStatus",[],(function(a,b,c,d,e,f){function a(){var a=arguments,b=a[a.length-1],c=[];return b.sequence([function(c){return b.db.table(70).put({query:a[0],type_:a[1],threadKeyV2:a[5]==null?b.i64.cast([0,0]):a[5],status:a[2],hasNextPage:a[3],nextPageCursor:a[4],resultCount:a[6]})},function(a){return b.resolve(c)}])}a.__sproc_name__="LSSearchUpdateMessageSearchQueryStatusStoredProcedure";a.__tables__=["message_search_queries"];e.exports=a}),null);
__d("LSIssueMessageSearchQuery",["LSIssueNewTask","LSUpdateMessageSearchQueryStatus"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1],d=[],e=[];return c.sequence([function(e){return c.sequence([function(d){return c.storedProcedure(b("LSUpdateMessageSearchQueryStatus"),a[0],a[1],c.i64.cast([0,1]),void 0,a[3],a[2],c.i64.cast([0,0]))},function(e){return d[0]=new c.Map(),d[0].set("query",a[0]),d[0].set("type",a[1]),d[0].set("thread_key",a[2]),d[0].set("next_page_cursor",a[3]),d[1]=c.toJSON(d[0]),c.storedProcedure(b("LSIssueNewTask"),"message_search",c.i64.cast([0,107]),d[1],void 0,void 0,c.i64.cast([0,0]),c.i64.cast([0,0]),void 0,void 0,c.i64.cast([0,0]),c.i64.cast([0,0]))}])},function(a){return c.resolve(e)}])}a.__sproc_name__="LSSearchIssueMessageSearchQueryStoredProcedure";a.__tables__=[];e.exports=a}),null);
__d("LSIssueMessageSearchQueryStoredProcedure",["LSIssueMessageSearchQuery","LSSynchronousPromise","Promise","cr:8709"],(function(a,b,c,d,e,f,g){var h;function a(a,e){a=a.storedProcedure(c("LSIssueMessageSearchQuery"),e.query,e.type_,e.threadKey,e.nextPageCursor);return(h||(h=b("Promise"))).resolve(d("LSSynchronousPromise").maybeExtractValueIfSynchronousPromise(a))}g["default"]=a}),98);
__d("MWInboxMessageSearchPanelHeader.react",["fbt","MWResponsiveLayoutConstants","MWResponsiveLayoutContext.react","MWXCircleButton.react","MWXIconCross","MWXRow.react","MWXRowItem.react","MWXText.react","react","react-compiler-runtime"],(function(a,b,c,d,e,f,g,h){"use strict";var i,j=i||(i=d("react"));b=i;b.useCallback;var k=b.useContext;function a(a){var b=d("react-compiler-runtime").c(13),e=a.onReturn;a=a.titleComponent;var f=k(c("MWResponsiveLayoutContext.react")),g;b[0]!==f||b[1]!==e?(g=function(){e(),f==null||f.popCard(d("MWResponsiveLayoutConstants").MWLayoutPanel.INFO_PANEL)},b[0]=f,b[1]=e,b[2]=g):g=b[2];g=g;var i;b[3]===Symbol["for"]("react.memo_cache_sentinel")?(i=h._(/*BTDS*/"Back"),b[3]=i):i=b[3];b[4]!==g?(i=j.jsx(c("MWXRowItem.react"),{children:j.jsx(c("MWXCircleButton.react"),{icon:c("MWXIconCross"),label:i,onPress:g,size:32,type:"deemphasized"})}),b[4]=g,b[5]=i):i=b[5];b[6]!==a?(g=a!=null?a:j.jsx(c("MWXText.react"),{isSemanticHeading:!0,type:"bodyLink2",children:h._(/*BTDS*/"Search")}),b[6]=a,b[7]=g):g=b[7];b[8]!==g?(a=j.jsx(c("MWXRowItem.react"),{expanding:!0,verticalAlign:"center",children:g}),b[8]=g,b[9]=a):a=b[9];b[10]!==i||b[11]!==a?(g=j.jsxs(c("MWXRow.react"),{paddingHorizontal:16,paddingTop:16,spacingHorizontal:8,children:[i,a]}),b[10]=i,b[11]=a,b[12]=g):g=b[12];return g}g["default"]=a}),226);
__d("useMWPConversatioSearchQPLLogger",["QPLUserFlow","emptyFunction","qpl","react","react-compiler-runtime"],(function(a,b,c,d,e,f,g){"use strict";var h;b=h||d("react");b.useCallback;b.useMemo;var i={currentResultCount:0,firstResultShowUp:!1,hasStarted:!1,instanceKey:0};function a(){var a=d("react-compiler-runtime").c(3),b=n,e=m,f;a[0]===Symbol["for"]("react.memo_cache_sentinel")?(f=function(a){i.hasStarted&&e();i.hasStarted=!0;i.instanceKey=i.instanceKey+1;i.firstResultShowUp=!1;i.currentResultCount=0;c("QPLUserFlow").start(c("qpl")._(25301522,"2409"),{annotations:a,instanceKey:i.instanceKey});return i.instanceKey},a[0]=f):f=a[0];f=f;var g=l,h;a[1]===Symbol["for"]("react.memo_cache_sentinel")?(h=function(a){if(i.firstResultShowUp)return;i.firstResultShowUp=!0;b({instanceKey:a,point:"first_result_show_up"})},a[1]=h):h=a[1];h=h;var o=k,p=j;a[2]===Symbol["for"]("react.memo_cache_sentinel")?(p={getCurrentInstanceKey:p,qplAddAnnotations:c("emptyFunction"),qplAddPoint:b,qplCancel:e,qplMarkFirstResultShowUp:h,qplStart:f,qplSuccess:g,updateCurrentResultCount:o},a[2]=p):p=a[2];h=p;f=h;return f}function j(){return i.instanceKey}function k(a){i.currentResultCount=a}function l(a){if(!i.hasStarted)return;if(a!=null&&a!==i.instanceKey)return;i.hasStarted=!1;c("QPLUserFlow").endSuccess(c("qpl")._(25301522,"2409"),{annotations:{"int":{result_count:i.currentResultCount}},instanceKey:i.instanceKey})}function m(a){if(!i.hasStarted)return;if(a!=null&&a!==i.instanceKey)return;i.hasStarted=!1;c("QPLUserFlow").endCancel(c("qpl")._(25301522,"2409"),{annotations:{"int":{result_count:i.currentResultCount}},instanceKey:i.instanceKey})}function n(a){var b=a.annotations,d=a.instanceKey;a=a.point;if(!i.hasStarted)return;if(d!=null&&d!==i.instanceKey)return;c("QPLUserFlow").addPoint(c("qpl")._(25301522,"2409"),a,{data:b,instanceKey:i.instanceKey})}g["default"]=a}),98);
__d("useMWPConversationSearch",["I64","LSFactory","LSIntEnum","LSIssueMessageSearchQueryStoredProcedure","LSMessageSearchType","LSSearchRequestStatusType","MAWThreadCutover","MWPConversationSearchContext.react","MWPConversationSearchLogger","MWPVisibleMessageContext.react","ReQL","ReQLSuspense","isMWNewSearchUXEnabled","nullthrows","promiseDone","react","react-compiler-runtime","useMWPConversatioSearchQPLLogger","useReStore"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j,k;b=i||d("react");b.useCallback;var l=b.useContext,m=b.useEffect;b.useMemo;var n=b.useRef,o=(j||(j=d("LSIntEnum"))).ofNumber(c("LSMessageSearchType").MESSAGE);function p(a,b){a=[a,b].filter(Boolean);b=a.filter(function(a){return(j||(j=d("LSIntEnum"))).toNumber(a.status)===c("LSSearchRequestStatusType").COMPLETE});return b.length===0||b.length<a.length?void 0:b.reduce(function(a,b){return a+(k||(k=d("I64"))).to_float(b.resultCount)},0)}function q(a,b){if(b==null)return a==null?void 0:a.status;if(a==null)return b==null?void 0:b.status;if((j||(j=d("LSIntEnum"))).toNumber(a.status)===c("LSSearchRequestStatusType").FAILED||(j||(j=d("LSIntEnum"))).toNumber(b.status)===c("LSSearchRequestStatusType").FAILED)return(j||(j=d("LSIntEnum"))).ofNumber(c("LSSearchRequestStatusType").FAILED);a=Math.min((j||(j=d("LSIntEnum"))).toNumber(a.status),j.toNumber(b.status));return j.ofNumber(a)}function r(a,b){c("promiseDone")(a.runInTransaction(function(a){return c("LSIssueMessageSearchQueryStoredProcedure")(c("LSFactory")(a),{nextPageCursor:b.nextPageCursor,query:b.query,threadKey:b.threadKeyV2,type_:o})},"readwrite",void 0,void 0,f.id+":94"))}function a(a){var b=d("react-compiler-runtime").c(84),e=l(d("MWPConversationSearchContext.react").context),g;b[0]!==e?(g=c("nullthrows")(e),b[0]=e,b[1]=g):g=b[1];e=g;var i=e.search,t=e.setSearch;g=c("useMWPConversatioSearchQPLLogger")();var u=g.qplCancel,v=g.qplMarkFirstResultShowUp,w=g.updateCurrentResultCount;e=d("MWPVisibleMessageContext.react").useMWPVisibleMessageContext();var x=e.setVisibleMessage,y=(h||(h=c("useReStore")))(),z=d("MAWThreadCutover").useGetCutoverMapping(i==null?void 0:i.threadKey);b[2]!==y||b[3]!==i||b[4]!==a?(g=function(){return i!=null?d("ReQL").fromTableAscending(y.tables.message_search_queries).getKeyRange(o,i.query,a):d("ReQL").empty()},e=[y,i,a],b[2]=y,b[3]=i,b[4]=a,b[5]=g,b[6]=e):(g=b[5],e=b[6]);var A=d("ReQLSuspense").useFirst(g,e,f.id+":133");b[7]!==z||b[8]!==y||b[9]!==i?(g=function(){return i!=null&&z!=null&&z.showOpenMessageHistory===!0?d("ReQL").fromTableAscending(y.tables.message_search_queries).getKeyRange(o,i.query,z.openThreadId):d("ReQL").empty()},e=[y,i,z],b[7]=z,b[8]=y,b[9]=i,b[10]=g,b[11]=e):(g=b[10],e=b[11]);var B=d("ReQLSuspense").useFirst(g,e,f.id+":145"),C=i==null?void 0:i.query;b[12]!==u||b[13]!==i?(g=function(){i==null&&u()},e=[u,i],b[12]=u,b[13]=i,b[14]=g,b[15]=e):(g=b[14],e=b[15]);m(g,e);b[16]!==x?(g=function(a){x(function(b){return{contextLine:(b=a.contextLine)!=null?b:"",highlights:a.matchOffsets!=null&&a.matchLengths!=null?s(a.matchOffsets,a.matchLengths):[],messageId:a.messageId,messageOtid:a.messageOtid,source:"Search",timestamp:c("nullthrows")(a.messageTimestampMs)}})},b[16]=x,b[17]=g):g=b[17];var D=g;b[18]!==y||b[19]!==C||b[20]!==a?(e=function(){return C!=null?d("ReQL").fromTableAscending(y.tables.message_search_results).getKeyRange(o,C,a):d("ReQL").empty()},g=[y,C,a],b[18]=y,b[19]=C,b[20]=a,b[21]=g,b[22]=e):(g=b[21],e=b[22]);e=d("ReQLSuspense").useArray(e,g,f.id+":194");var E;b[23]!==z||b[24]!==y||b[25]!==C?(g=function(){return C!=null&&z!=null&&z.showOpenMessageHistory===!0?d("ReQL").fromTableAscending(y.tables.message_search_results).getKeyRange(o,C,z.openThreadId):d("ReQL").empty()},E=[y,C,z],b[23]=z,b[24]=y,b[25]=C,b[26]=g,b[27]=E):(g=b[26],E=b[27]);g=d("ReQLSuspense").useArray(g,E,f.id+":207");b[28]!==g||b[29]!==e?(E=[].concat(e,g),b[28]=g,b[29]=e,b[30]=E):E=b[30];g=E;var F=g;b[31]!==F.length||b[32]!==w?(e=function(){w(F.length)},b[31]=F.length,b[32]=w,b[33]=e):e=b[33];b[34]!==F||b[35]!==w?(E=[F,w],b[34]=F,b[35]=w,b[36]=E):E=b[36];m(e,E);var G=n(),H=i==null?void 0:i.selectedSearchResultIndex;b[37]!==F||b[38]!==D||b[39]!==v||b[40]!==H?(g=function(){if(F.length>0&&H!=null&&H<F.length){var a=F[H];G.current!==a&&(v(),c("isMWNewSearchUXEnabled")()||(c("MWPConversationSearchLogger").logMessageSearchMsgImpression(),D(a)),G.current=a)}},b[37]=F,b[38]=D,b[39]=v,b[40]=H,b[41]=g):g=b[41];b[42]!==F||b[43]!==D||b[44]!==v||b[45]!==H||b[46]!==x?(e=[D,F,H,x,v],b[42]=F,b[43]=D,b[44]=v,b[45]=H,b[46]=x,b[47]=e):e=b[47];m(g,e);b[48]!==D?(E=function(a){D(a)},b[48]=D,b[49]=E):E=b[49];g=E;b[50]!==F.length||b[51]!==y||b[52]!==B||b[53]!==A||b[54]!==i||b[55]!==H||b[56]!==t?(e=function(){if(i==null)return null;H===F.length-1&&(A==null?void 0:A.hasNextPage)===!0?r(y,A):H===F.length-1&&(B==null?void 0:B.hasNextPage)===!0&&r(y,B);t(babelHelpers["extends"]({},i,{selectedSearchResultIndex:i.selectedSearchResultIndex+1}));return i.selectedSearchResultIndex+1},b[50]=F.length,b[51]=y,b[52]=B,b[53]=A,b[54]=i,b[55]=H,b[56]=t,b[57]=e):e=b[57];E=e;b[58]!==i||b[59]!==t?(e=function(){if(i==null)return null;t(babelHelpers["extends"]({},i,{selectedSearchResultIndex:i.selectedSearchResultIndex-1}));return i.selectedSearchResultIndex-1},b[58]=i,b[59]=t,b[60]=e):e=b[60];e=e;var I;b[61]!==B||b[62]!==A?(I=q(A,B),b[61]=B,b[62]=A,b[63]=I):I=b[63];var J=I;I=(A==null?void 0:A.hasNextPage)===!0||(B==null?void 0:B.hasNextPage)===!0;var K;b[64]!==y||b[65]!==B||b[66]!==A||b[67]!==i||b[68]!==J?(K=function(){if(i==null||(k||(k=d("I64"))).equal(J!=null?J:(k||(k=d("I64"))).zero,(j||(j=d("LSIntEnum"))).ofNumber(c("LSSearchRequestStatusType").PENDING)))return;(A==null?void 0:A.hasNextPage)===!0?r(y,A):(B==null?void 0:B.hasNextPage)===!0&&r(y,B)},b[64]=y,b[65]=B,b[66]=A,b[67]=i,b[68]=J,b[69]=K):K=b[69];K=K;var L;b[70]!==B||b[71]!==A?(L=p(A,B),b[70]=B,b[71]=A,b[72]=L):L=b[72];L=L;var M=i==null?void 0:i.query,N;b[73]!==L||b[74]!==F||b[75]!==I||b[76]!==K||b[77]!==g||b[78]!==E||b[79]!==e||b[80]!==H||b[81]!==J||b[82]!==M?(N={hasMore:I,loadMore:K,navigateToResult:g,next:E,previous:e,query:M,resultCount:L,searchResults:F,selectedSearchResultIndex:H,status:J},b[73]=L,b[74]=F,b[75]=I,b[76]=K,b[77]=g,b[78]=E,b[79]=e,b[80]=H,b[81]=J,b[82]=M,b[83]=N):N=b[83];return N}function s(a,b){a=a.split(",");var c=b.split(",");return a.map(function(a,b){return{matchLength:parseInt(c[b],10),matchOffset:parseInt(a,10)}})}g["default"]=a}),98);
__d("MWLSChatTabBackToSearchButton.react",["fbt","Locale","MWXCircleButton.react","MWXIconArrowLeft","MWXIconArrowRight","MWXThreadThemeColor","react","react-compiler-runtime","useMWPConversationSearch","usePushChatTabMessageSearchPage.react"],(function(a,b,c,d,e,f,g,h){"use strict";var i,j=i||c("react");function a(a){var b=d("react-compiler-runtime").c(7),e=a.pushPage,f=a.tab;a=a.thread;var g=a.threadKey;a=a.threadType;var i=c("useMWPConversationSearch")(g),k;b[0]!==g||b[1]!==a?(k={threadKey:g,threadType:a},b[0]=g,b[1]=a,b[2]=k):k=b[2];g=c("usePushChatTabMessageSearchPage.react")(k,f,e);if(i.searchResults.length===0)return null;a=d("Locale").isRTL()?c("MWXIconArrowRight"):c("MWXIconArrowLeft");b[3]===Symbol["for"]("react.memo_cache_sentinel")?(k=d("MWXThreadThemeColor").mwxThreadThemeColor("var(--mwp-header-button-color)"),b[3]=k):k=b[3];b[4]===Symbol["for"]("react.memo_cache_sentinel")?(f=h._(/*BTDS*/"Back"),b[4]=f):f=b[4];b[5]!==g?(e=j.jsx(c("MWXCircleButton.react"),{color:k,icon:a,label:f,onPress:g,size:36,type:"deemphasized"}),b[5]=g,b[6]=e):e=b[6];return e}g["default"]=a}),226);
__d("MWMessageSearchMessageSnippet.react",["MWXMessageTextWithEntities.react","MWXTextImpl.react","react","react-compiler-runtime"],(function(a,b,c,d,e,f,g){"use strict";var h,i=h||d("react"),j=function(a){return i.jsx(c("MWXTextImpl.react"),{color:"primary",type:"bodyLink4",children:a})};function a(a){var b=d("react-compiler-runtime").c(19);a=a.item;var e;if(b[0]!==a.contextLine||b[1]!==a.matchLengths||b[2]!==a.matchOffsets){var f,g;f=(f=(f=a.matchOffsets)==null?void 0:f.split(","))!=null?f:[];if(b[6]!==a.matchLengths){var h;h=(h=(h=a.matchLengths)==null?void 0:h.split(","))!=null?h:[];b[6]=a.matchLengths;b[7]=h}else h=b[7];var k=h;h=Number(f[0]);g=(g=(g=a.contextLine)==null?void 0:g.length)!=null?g:0;g=h+15>g;g=g?30:15;var l=Math.max(0,h-g);e=l>0;if(b[8]!==a.contextLine||b[9]!==l){h=(g=(h=a.contextLine)==null?void 0:h.slice(l,a.contextLine.length))!=null?g:"";b[8]=a.contextLine;b[9]=l;b[10]=h}else h=b[10];g=h;b[11]!==k||b[12]!==e||b[13]!==l?(h=function(a,b){return{entity:{__typename:"Bold"},length:Number(k[b]),offset:Number(a)-l+(e?3:0)}},b[11]=k,b[12]=e,b[13]=l,b[14]=h):h=b[14];f=f.map(h);b[0]=a.contextLine;b[1]=a.matchLengths;b[2]=a.matchOffsets;b[3]=e;b[4]=f;b[5]=g}else e=b[3],f=b[4],g=b[5];h=f;b[15]===Symbol["for"]("react.memo_cache_sentinel")?(a={Bold:[j]},b[15]=a):a=b[15];f=e?"..."+g:g;b[16]!==h||b[17]!==f?(g=i.jsx(c("MWXMessageTextWithEntities.react"),{ranges:h,renderers:a,text:f}),b[16]=h,b[17]=f,b[18]=g):g=b[18];return g}g["default"]=a}),98);
__d("useMWPStartConversationSearch",["Int64Hooks","LSClearMessageSearchTableStoredProcedure","LSFactory","LSIntEnum","LSIssueMessageSearchQueryStoredProcedure","LSMessageSearchType","MAWThreadCutover","MWLSThreadDisplayContext","MWPActor.react","MWPConversationSearchContext.react","MWPVisibleMessageContext.react","cr:1280","nullthrows","promiseDone","react","react-compiler-runtime","useMWPConversatioSearchQPLLogger","useReStore"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j,k=(i||d("react")).useContext,l=(j||(j=d("LSIntEnum"))).ofNumber(c("LSMessageSearchType").MESSAGE);function a(a){var e=d("react-compiler-runtime").c(11),g=d("MWPActor.react").useActor(),i=(h||(h=c("useReStore")))(),j=d("MWLSThreadDisplayContext").useMWLSThreadDisplayContext(),o=d("MWPVisibleMessageContext.react").useMWPVisibleMessageContext(),p=o.setVisibleMessage,q=c("useMWPConversatioSearchQPLLogger")();o=k(d("MWPConversationSearchContext.react").context);var r;e[0]!==o?(r=c("nullthrows")(o),e[0]=o,e[1]=r):r=e[1];o=r;var s=o.setSearch;e[2]!==g||e[3]!==i||e[4]!==j||e[5]!==q||e[6]!==s||e[7]!==p||e[8]!==a?(r=function(e,h,k){var o=(k=k==null?void 0:k.clearMessageSearch)!=null?k:!0;s({query:e,selectedSearchResultIndex:0,threadKey:a});p(n);k=async function(){o&&await i.runInTransaction(m,"readwrite",void 0,void 0,f.id+":69"),q.qplStart({bool:{isInThread:!0,isSecure:h},string:{display_surface:j}}),h&&b("cr:1280")!=null?(c("promiseDone")(b("cr:1280").searchSecureDatabaseMessages(e,a,g,i,{flow:q,instanceKey:q.getCurrentInstanceKey()})),c("promiseDone")(d("MAWThreadCutover").getCutoverThreadBySecureThreadKey(a),function(a){a!=null&&a.showOpenMessageHistory===!0&&c("promiseDone")(i.runInTransaction(async function(b){await c("LSIssueMessageSearchQueryStoredProcedure")(c("LSFactory")(b),{query:e,threadKey:a.openThreadId,type_:l})},"readwrite",void 0,void 0,f.id+":101"))})):c("promiseDone")(i.runInTransaction(async function(b){await c("LSIssueMessageSearchQueryStoredProcedure")(c("LSFactory")(b),{query:e,threadKey:a,type_:l})},"readwrite",void 0,void 0,f.id+":117"))};c("promiseDone")(k())},o=[s,a,p,i,g,q,j],e[2]=g,e[3]=i,e[4]=j,e[5]=q,e[6]=s,e[7]=p,e[8]=a,e[9]=r,e[10]=o):(r=e[9],o=e[10]);e=d("Int64Hooks").useCallbackInt64(r,o);return e}async function m(a){await c("LSClearMessageSearchTableStoredProcedure")(c("LSFactory")(a),{type_:l})}function n(a){}g.default=a}),98);