;/*FB_PKG_DELIM*/

__d("convertVideoToPhoto",[],(function(a,b,c,d,e,f){"use strict";var g=["activeCaptionID","activeDubbingID","fileMimeType","trimData","videoAttachmentAudioDescriptionsMetadata","videoAttachmentMetadata","videoAttachmentTextTranscriptsMetadata"];function a(a){var b=a.data.id;a.activeCaptionID;a.activeDubbingID;a.fileMimeType;a.trimData;a.videoAttachmentAudioDescriptionsMetadata;a.videoAttachmentMetadata;a.videoAttachmentTextTranscriptsMetadata;a=babelHelpers.objectWithoutPropertiesLoose(a,g);if(b==null)return null;switch(a.state){case"NEW":return babelHelpers["extends"]({},a,{data:{id:b},fileType:"PHOTO"});case"CLIENT_PROCESSING_COMPLETE":return babelHelpers["extends"]({},a,{data:{id:b},fileType:"PHOTO"});case"CLIENT_PROCESSING":return babelHelpers["extends"]({},a,{data:{id:b},fileType:"PHOTO"});case"QUEUED":return babelHelpers["extends"]({},a,{data:{id:b},fileType:"PHOTO"});case"FAILED":return babelHelpers["extends"]({},a,{data:{id:b},fileType:"PHOTO"})}}f["default"]=a}),66);
__d("extractMediaLocationData",["FBLogger","exif-js","getErrorSafe"],(function(a,b,c,d,e,f,g){"use strict";function h(a){return a[0].numerator+a[1].numerator/(60*a[1].denominator)+a[2].numerator/(3600*a[2].denominator)}function i(a){return new Promise(function(b,c){var d=new FileReader();d.onload=function(){d.result instanceof ArrayBuffer?b(d.result):c(d.error)};d.onerror=function(){c(d.error)};d.readAsArrayBuffer(a)})}async function a(a){try{a=await i(a);a=c("exif-js").readFromBinaryFile(a);if(!a.GPSLongitude||!a.GPSLatitude)return null;var b=a.GPSLatitudeRef||"N",d=a.GPSLongitudeRef||"W";b=h(a.GPSLatitude)*(b==="N"?1:-1);a=h(a.GPSLongitude)*(d==="W"?-1:1);d={accuracy:0,latitude:b,longitude:a,stale_time:0};return d}catch(a){b=c("getErrorSafe")(a);c("FBLogger")("comet_composer").catching(b).mustfix("Failed to extract GPS location from media");return null}}g.extractMediaLocationData=a}),98);
__d("processNewMediaAttachments",["FBLogger","cometIsMimeTypeForMedia","cometUniqueID","extractMediaLocationData","getErrorSafe"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b){return(a!=null?a:[]).map(function(a){if(a==null)return null;var c=a.uploadID;c=c!=null&&b!=null?b[c]:void 0;return h(a,c)}).filter(Boolean)}function h(a,b){var e;e=(e=a.uploadID)!=null?e:c("cometUniqueID")();a.uploadID=e;var f=URL.createObjectURL(a);if(d("cometIsMimeTypeForMedia").isMimeTypeForPhoto(a.type)){var g=(b==null?void 0:b.type)==="PHOTO"?b==null?void 0:b.data:void 0;return babelHelpers.extends({data:{id:e},file:a,fileObjectURL:f,fileType:"PHOTO",state:"NEW"},g)}else if(d("cometIsMimeTypeForMedia").isMimeTypeForVideo(a.type)){g=(b==null?void 0:b.type)==="VIDEO"?b==null?void 0:b.data:void 0;return babelHelpers.extends({data:{id:e},file:a,fileMimeType:a.type,fileObjectURL:f,fileType:"VIDEO",state:"NEW"},g)}else return{data:{id:e},file:a,fileObjectURL:f,fileType:"UNKNOWN",state:"NEW"}}async function b(a){var b=new Map();a=a.filter(function(a){return d("cometIsMimeTypeForMedia").isMimeTypeForPhoto(a.type)});if(a.length===0)return b;a=a.map(async function(a){try{var e=await d("extractMediaLocationData").extractMediaLocationData(a);a=a.uploadID;e!=null&&a!=null&&b.set(a,e)}catch(b){a=c("getErrorSafe")(b);c("FBLogger")("comet_composer").catching(a).warn("Failed to extract GPS location data from photo during batch processing")}});await Promise.all(a);return b}g.processNewMediaAttachments=a;g.getNewMediaAttachment=h;g.extractLocationDataForPhotos=b}),98);